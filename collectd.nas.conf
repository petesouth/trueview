Hostname "freenas.pete_vm"
FQDNLookup true
BaseDir "/var/db/collectd"
PIDFile "/var/run/collectd.pid"
PluginDir "/usr/local/lib/collectd"

LoadPlugin aggregation
LoadPlugin cpu
LoadPlugin ctl
LoadPlugin df
LoadPlugin disk
LoadPlugin exec
LoadPlugin geom_stat
LoadPlugin interface
LoadPlugin load
LoadPlugin memory
LoadPlugin network
LoadPlugin processes
LoadPlugin rrdtool
LoadPlugin swap
LoadPlugin uptime
LoadPlugin syslog
LoadPlugin tcpconns
LoadPlugin threshold
LoadPlugin zfs_arc
LoadPlugin zfs_arc_v2

<Plugin "syslog">
    LogLevel err
</Plugin>

<Plugin aggregation>
  <Aggregation>
    #Host "unspecified"
    Plugin "cpu"
    #PluginInstance "unspecified"
    Type "cpu"
    #TypeInstance "unspecified"

    GroupBy "Host"
    GroupBy "TypeInstance"

    CalculateNum true
    CalculateSum true
    CalculateAverage true
    CalculateMinimum true
    CalculateMaximum true
    CalculateStddev true
  </Aggregation>
</Plugin>

<Plugin "aggregation">
	<Aggregation>
		Plugin "cpu"
		Type "cpu"

		SetPlugin "cpu"
		SetPluginInstance "%{aggregation}"

		GroupBy "Host"
		GroupBy "TypeInstance"

		CalculateNum true
		CalculateSum true
		CalculateAverage true
		CalculateMinimum true
		CalculateMaximum true
		CalculateStddev true
	</Aggregation>
  	<Aggregation>
		Plugin "df"
		Type "percent_bytes"
		GroupBy "Host"
		GroupBy "TypeInstance"
		CalculateMinimum true
		CalculateMaximum true
		CalculateAverage true
		CalculateSum true
	#    	SetHost "global"
		SetPlugin "df"
		SetPluginInstance "%{aggregation}"
	</Aggregation>
	<Aggregation>
#		Host "trueview"
		Plugin "df"
		Type "df_complex"

		SetPlugin "df"
		SetPluginInstance "%{aggregation}"
		GroupBy "Host"
		GroupBy "TypeInstance"

		CalculateNum true
		CalculateSum true
		CalculateAverage true
		CalculateMinimum true
		CalculateMaximum true
		CalculateStddev true
	</Aggregation>
  	<Aggregation>
		Plugin "memory"
		Type "memory"
		GroupBy "Host"
		GroupBy "TypeInstance"
		CalculateMinimum true
		CalculateMaximum true
		CalculateAverage true
		CalculateSum true
		SetPlugin "memory"
		SetPluginInstance "%{aggregation}"
	</Aggregation>
  	<Aggregation>
		Plugin "uptime"
		Type "uptime"
		GroupBy "Host"
		#GroupBy "TypeInstance"
		CalculateMinimum true
		CalculateMaximum true
		CalculateAverage true
		SetPlugin "uptime"
		SetPluginInstance "%{aggregation}"
	</Aggregation>
  	<Aggregation>
		Plugin "swap"
		Type "swap"
		GroupBy "Host"
		#GroupBy "TypeInstance"
		CalculateMinimum true
		CalculateMaximum true
		CalculateAverage true
		SetPlugin "swap"
		SetPluginInstance "%{aggregation}"
	</Aggregation>
  	<Aggregation>
		Plugin "processes"
		Type "processes"
		GroupBy "Host"
		#GroupBy "TypeInstance"
		CalculateMinimum true
		CalculateMaximum true
		CalculateAverage true
		SetPlugin "processes"
		SetPluginInstance "%{aggregation}"
	</Aggregation>
  	<Aggregation>
		Plugin "interface"
		Type "interface"
		GroupBy "Host"
		#GroupBy "TypeInstance"
		CalculateMinimum true
		CalculateMaximum true
		CalculateAverage true
		CalculateSum true
		SetPlugin "interface"
		SetPluginInstance "%{aggregation}"
	</Aggregation>
#  	<Aggregation>
#		Plugin "disk"
#		Type "disk"
#		GroupBy "Host"
#		GroupBy "TypeInstance"
#		CalculateMinimum true
#		CalculateMaximum true
#		CalculateAverage true
#		CalculateSum true
#		SetPlugin "disk"
#		SetPluginInstance "%{aggregation}"
#	</Aggregation>
</Plugin>


<Plugin cpu>
  ReportByCpu true
  ReportByState true
  ValuesAbsolute false
  ValuesPercentage true
</Plugin>

<Plugin df>
	ReportInodes false
	ValuesAbsolute true
	ValuesPercentage true
	FSType "zfs"
	IgnoreSelected false
</Plugin>

<Plugin "disk">
    Disk "/^gptid/"
    Disk "/^md/"
    Disk "/^pass/"
    IgnoreSelected true
</Plugin>

<Plugin "exec">
    NotificationExec "nobody" "/usr/local/www/freenasUI/tools/collectd_alert.py"
    Exec "nobody:nobody" "/bin/echo" "PUTVAL localhost/collectd/ping N:1"
</Plugin>
<Plugin exec>
        Exec "TrueDisk Checker" "/usr/local/www/trueview/scripts/truedisk_checker.sh"
</Plugin>

<Plugin "interface">
    Interface "lo0"
    Interface "ipfw0"
    Interface "pflog0"
    Interface "pfsync0"
    Interface "plip0"
    Interface "/^usbus/"
    IgnoreSelected true
</Plugin>

<Plugin load>
       ReportPercent true
       ReportRelative true
</Plugin>

<Plugin memory>
	ValuesAbsolute true
	ValuesPercentage true
</Plugin>

<Plugin processes>
	Process "name"
</Plugin>

<Plugin "rrdtool">
    DataDir "/var/db/collectd/rrd"
    CacheTimeout 120
    CacheFlush 900
</Plugin>

<Plugin tcpconns>
	ListeningPorts true
	AllPortsSummary true
</Plugin>

<Plugin "threshold">
  <Plugin "ctl">
    Instance "ha"
    <Type "disk_octets">
      WarningMax 10000000
      Persist true
      Interesting false
    </Type>
  </Plugin>
</Plugin>

<Plugin "zfs_arc">
</Plugin>

<Plugin "geom_stat">
	Filter "^([a]?da|ciss|md|mfi|md|xbd|vtbd)[0123456789]+(p[0123456789]+)?(\.eli)?$"
</Plugin>

LoadPlugin write_graphite
<Plugin "write_graphite">
  <Node "graphite">
    Host "trueview-demo.freehive.io"
    Port "2003"
    Protocol "tcp"
    LogSendErrors true
    Prefix "servers."
    Postfix ""
    StoreRates true
    AlwaysAppendDS false
    EscapeCharacter "_"
  </Node>
</Plugin>
